# 선용품 최적 구매발주 예측 분석 웹서비스
- 부산대학교 K-Digital 풀스택 개발자 양성과정에서 마린소프트와 연계하여 진행한 프로젝트입니다.
- 2019~2020년도의 발주정보 데이터를 머신러닝을 통해 학습하여 카테고리와 리드타임을 예측하는 모델을 제작하였습니다.
- 제작된 모델을 통해 새로운 품목의 카테고리와 리드타임을 예측하는 서비스 입니다.
- URL : http://3.37.27.133:3000/
## 프로젝트 개요
![개요](https://user-images.githubusercontent.com/106790381/224225899-91d33ddd-9255-4dda-b5ea-13def31bc4c0.jpg)
### 1. 프로젝트 목적
- 리드타임(발주 ~ 창고입고까지의 시간)을 예측하여 발주 일정 관리 효율화
- 리드타임의 정확한 예측을 위한 선용품목의 카테고리 자동 분류
### 2. 주요 기능
#### 1) 카테고리, 리드타임 예측 
- 품목의 기본 정보를 입력하면 카테고리, 리드타임 예측값을 출력한다.
![예측](https://user-images.githubusercontent.com/106790381/224226490-4e32f307-38cd-4763-be2b-1a07434ec87d.jpg)

#### 2) 장바구니
- 검색한 목록 중 선택한 목록을 예측된 리드타임과 함께 출력한다.
- 날짜를 선택하면 리드타임과 계산되어 현재 발주 가능한 품목을 알려준다.
![장바구니](https://user-images.githubusercontent.com/106790381/224226860-ec4a048b-72c8-4634-95fb-6ee37858f524.jpg)

### 3. 개발 환경
#### FrontEnd
- IDE: VS Code
- 개발 환경: react, react-router-dom, react-redux, redux-toolkit, axios, react-calander, nivo, react-js-pagination, jwt-decode, moment

#### BackEnd
- IDE: Spring Tool Suite 4
- 개발 환경: Spring Boot, Spring Data JPA, Spring Security, io.jsonwebtoken, MySQL, DevTool, Lombok

### 4. DB 구조
![DB구조](https://user-images.githubusercontent.com/106790381/224694770-c49ebcd4-332e-4543-9752-83173bd88982.jpg)

### 5. 시스템 구성도
![클래스 다이어그램](https://user-images.githubusercontent.com/106790381/224227198-419f5121-9843-47a0-8c34-d5ba8c7251e6.jpg)

## 프로젝트 구현 시 나의 역할
#### 1. 와이어 프래임을 기반으로 컴포넌트 개발
-	물품 검색 화면, 과거 데이터 조회 및 추천 품목 출력 화면, 장바구니 화면, 카테고리, 리드타임 예측 화면을 개발하였따.
- Redux, React Hook, calender등의 라이브러리를 이용하여 계획한 기능을 구현하였다.
- Router 기능과 토큰의 권한 정보를 이용하여 권한이 인증된 이용자만 사용할 수 있는 페이지를 제작하였다.
#### 2. 비동기통신을 활용한 프론트엔드와 백엔드 연동
- Axios instance를 이용한 API컴포넌트를 구성하여 RestAPI서버와의 통신을 구현하였다. 각 컴포넌트에서 효율적으로 백엔드와의 통신을 구현할 수 있었다.
#### 3. Json Web Token을 이용한 인증 기능 구현
- Springboot에서 Spring Security와 jwt기능을 구현하여 Access Token, Refresh Token발급 및 재발급, 통신 시 토큰 유효성 검사 등의 기능을 구현하였다.
- React에서 발급된 토큰을 저장하고 통신 요청시 토큰을 Header와 함께 전송하였고, 토큰 만료시 API컴포넌트에서 자동으로 재발급을 요청하는 기능을 구현하였다.
#### 4. flask 서버 구현
- 팀원이 제작한 카테고리, 리드타임 예측 모델을 flask 서버에 올려 리액트에서 요청을 보냈을 때 예측 모델이 구현되도록 하였다.
#### 5. Docker, AWS를 활용한 프로젝트 배포
- docker를 활용해 AWS에 제작한 프로젝트 결과물을 배포하였다.

## 개선 사항
#### 1. Json Web Token 기능 강화
- 짧은 시간 내에 기능을 구현하다 보니 구현 코드에 대한 깊은 이해와 공부를 할 시간이 부족해 불완전한 기능구현에 그쳤다. 예를 들어 효과적인 공격 방어를 위한 토큰의 저장 위치, Redis를 활용한 refresh토큰 이용 등을 개선해 볼 여지가 있었다.
#### 2. 프론트앤드 컴포넌트 구조 개선
- 컴포넌트 폴더 각각의 이름을 바로 알아볼 수 있는 이름으로 변경하여 다른 파트 개발자들이 보아도 쉽게 알아볼 수 있도록 할 필요가 있었다.
- 리스트 체크박스를 위한 기능이 두 컴포넌트에 사용되었는데 관련 코드를 반복해서 사용했다. 함수화하여 새로운 컴포넌트로 구성할 필요가 있다.
#### 3. GitHub Action 기능을 이용한 배포 자동화
- GitHub Action기능을 활용해 CD/CI 자동화를 시도했으나 실패했다. (folked repository에서 pull request를 하면 action기능의 secrets 변수들이 넘어가지 않아서 원하는 상황을 만들지 못했다.) 다른 시야에서 새로운 방식을 찾아 볼 필요가 있다.
#### 4. AWS 리소스 문제
- React, Springboot, flask를 도커 이미지화 하여 aws에 업로드 했지만 제작한 서비스가 생각보다 무거워 2개의 aws 개정에 업로드 했다. (프리티어에서 모두 돌리지 못함)
- 또한 품목 추천 시스템이 프리티어의 메모리 용량을 초과하여 구현되지 못했다. 서비스의 최적화가 필요하다.

## 경험했던 문제
#### 1. useContext를 사용한 전역 상태관리에서 리랜더링 발생하는 문제
- context가 변경되면 해당 범위에 있는 컴포넌트들이 리랜더링 되는 것을 막을 수 없어 문제가 발생했다.
- 이를 해결하기 위해 Redux-toolkit을 도입하여 부분적인 리랜더링이 되도록 변경했다.
#### 2. 통신 코드 변경시 모든 컴포넌트에서 변경해야 하는 문제
- axios를 활용한 비동기 통신코드를 필요한 컴포넌트마다 작성하였는데 url이 변경될 때 불편함이 발생했다.
- axios instance를 생성하여 url, header등 자주 변경이 발생하는 부분을 한곳에서 관리할 수 있도록 변경했다.
#### 3. 토큰의 만료시간을 갱신할 때 다시 로그인 해야하는 문제
- 토큰의 만료시간이 지나면 재 로그인으로 다시 토큰을 발급 받아야 하는 문제가 발생했다.
- 앞서 생성한 axios instance의 response를 interceptors하는 방법을 사용하여 토큰 만료로 401 에러가 발생할 때 자동으로 갱신 요청을 보내도록 변경했다.
#### 4. 두 서버를 비효율적으로 사용하는 문제
- 장바구니에 담긴 물품의 리드타임을 예측할 때 리액트 <--> 스프링부트 통신으로 장바구니 데이터를 받아 온 다음 그 데이터를 다시 리액트 <--> 플라스트로 통신하는 방식이어서 개선이 필요해 보였다.
- 리액트 <--> 스프링부트 <--> 플라스크로 통신할 수 있도록 스프링부트의 서비스 로직을 변경했다.
#### 5. 스프링부트에서 불필요한 쿼리가 발생하는 문제
- 스프링부트에서 로그인한 멤버의 장바구니 목록을 확인할 때 모든 장바구니 데이터 하나하나를 멤버정보와 비교하는 쿼리가 발생하고 있었다.
- MemberDto를 만들어서 현재 로그인한 아이디에 해당하는 장바구니목록을 호출하는 하나의 쿼리만 생성되도록 변경했다.
